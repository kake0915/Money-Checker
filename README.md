# Money-Checker

## 概要
日本の紙幣，硬貨が映った画像を入力すると，画像中のお金の合計金額を出力するプログラムである．
<img src="https://github.com/kake0915/Money-Checker/blob/master/images/coins2.JPG" width="400" height="300" alt="inputImage" title="入力画像例">

入力画像例

<img src="https://github.com/kake0915/Money-Checker/blob/master/images/imageOut/coins2.jpg" width="300" height="400" alt="outputImage" title="出力画像例">

出力画像例

## 仕様
・開発環境：Python 3.6.5,OpenCv 3.4.0

・実行方法はソースコード26行目あたりのframePathに入力画像を与え，このプログラムを実行すると，出力画像を出力します．

・入力画像には黒い背景の上にお金を置いた画像を使用して下さい．

・紙幣，硬貨の裏表は問いません．

・硬貨の模様がはっきり映る（白飛びしない）様に撮影して下さい．

・現時点では1,100,500円玉の判別はできていません．（2018/07/28）

## 簡単なプログラムの内容

全体の大まかな流れを下記に示す．

①	硬貨や紙幣の写る画像を取得し，輪郭検出を用いて硬貨や紙幣を認識．

②	検出した輪郭の外接矩形で切り出し，それぞれの物体を１枚の画像として抽出．

③	注目している物体の輪郭と，外接矩形の最小外接円との面積比較を行い硬貨か紙幣のどちらなのかを判別．

④	紙幣に分類された場合は特徴点マッチングを用いてどの紙幣に該当するのかを判別．

⑤	硬貨に分類された場合，中心に穴が開いているかどうかを認識し，５円か５０円，それ以外かを判別．

⑥	５円か５０円はHSV空間を用いて判別．

⑦	HSV空間を用いて１０円かそれ以外かを判別．

⑧	それ以外の硬貨はエッジ画素を抽出し，テンプレート画像との比較を行い一致率が高い硬貨を求め種類を決定する．

⑨	最後に合計金額を出力する．


## 参考にしたサイト

　こちらのOpenCV-Pythonチュートリアルのサイトを参考にしてコードを作成した．
 
 各処理を行う関数などをこちらのサイトを参考にし，プログラムの流れやアルゴリズムはオリジナルで考え作成した．

http://labs.eecs.tottori-u.ac.jp/sd/Member/oyamada/OpenCV/html/index.html


## Youtubeのサムネイル

以下に実行画面をキャプチャした動画のURLを示す．どの様に処理が行われているのかわかりやすい様に今回は，画像を出力しながら実行した．本来ならば入力画像を与えると，出力画像を画面に表示し，フォルダに保存するのみのプログラムである．逐次画面出力は行わない．また，今回は処理をわかりやすくするため，各処理を行う前にwaitKeyで一時停止し，ユーザがescキーを押したら，次の処理に行う様にしている．本来ならば，硬貨と紙幣は同じ入力画像に存在して良いが，今回は硬貨のみが写った画像と紙幣のみが写った画像を使用して実行した．

①硬貨の写った画像の実行動画

https://youtu.be/i2DFpAsS8E8

動画内に出てくる各windowについて説明を行う．

input:入力画像を表示

output:出力画像を表示

target:入力画像から切り出した注目物体の画像(見本の硬貨と向きが同じと判断した向きを向いている．見本と同じ効果の場合向きが正しく判断できていることがわかる．)

temprate:形状マッチングを行う際に用いた見本画像

much:見本とターゲットの向きを揃えたのち，二つの画像を重ね合わせ，一致しているかを判断する画像

②紙幣の写った画像の実行動画

https://youtu.be/iSgl1y4dgs8

動画内に出てくる各windowについて説明を行う．

input:入力画像を表示

output:出力画像を表示

target:入力画像から切り出した注目物体の画像

temprate:特徴点マッチングを行う際に用いた見本画像


## まとめと感想

本プログラムでは，紙幣であれば100%に近い認識率を出せた．また，5円，50円，10円も80%~90%くらいの認識率の精度で行えた．ただ，1円，100円，500円はまだ識別できないため，今後の改善が必要である．紙幣は，周りの自然光によって写り方も大きく変わらず，特徴点抽出でうまく特徴点を抽出できたので高い認識率の精度が出せた．一方硬貨は，周りの環境により，光沢，色，光具合などが大きく変わるため判断が難しかった．5円，50円は穴が空いているため判断しやすく，10
円も他の硬貨と色の差が大きいので認識できた．しかし，1円，100円，500円は色も硬貨の模様も似ているため非常に難しかった．この３つの硬貨を認識する方法を，本コード以外のアルゴリズムでも何度か試したがうまくいかなかった．ターゲットと見本の硬貨の種類と裏表が同じ時，向きを揃えることはできたが，その後の処理が良くなかったと考えられる．2枚の画像を掛け合わせて，同じ画像なら輪郭部分がはっきりと出て，違う硬貨なら全てキャンセルさせると考えたが，ノイズが多く，５００円の裏は複雑な模様で輪郭が多く，1円のおもてはシンプルで輪郭が少ないなどの問題からうまくいかなかった．

本プログラムを作成するのに半月くらいの時間をかけたので，全て認識できる様にしたかった．ただ，プログラムを書きながら様々な処理を勉強できたので，今後につなげていければと思う．また，1円，100円，500円を認識する方法を考えているので，今後改良していきたい．リアルタイムな認識も行えていないので，今後行っていきたい．







